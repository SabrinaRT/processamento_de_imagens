<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
      crossorigin="anonymous"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Processamento de Imagem</title>
    <script src="https://www.dukelearntoprogram.com/course1/common/js/image/SimpleImage.js"></script>

    <style>
      body {
        font-family: "Arial";
        margin: 20px;
      }

      .ImagemMostrar {
        max-height: 300px;
        max-width: 300px;
      }
      .center {
        display: flex;
        justify-content: center;
        align-items: center;
      }
    </style>

    <script>
      let imagem = null;

      function UploadImagem() {
        var ImagemUp = document.getElementById("UpButton");

        imagem = new SimpleImage(ImagemUp);

        var ImagemOri = document.getElementById("ImagemOri");
        imagem.drawTo(ImagemOri);
      }

      function grey() {
        let ImagemGrey = new SimpleImage(imagem);

        for (var p of ImagemGrey.values()) {
          var avg = (p.getRed() + p.getGreen() + p.getBlue()) / 3;
          p.setRed(avg);
          p.setGreen(avg);
          p.setBlue(avg);
        }

        var canvas = document.getElementById("ResultadoU");
        ImagemGrey.drawTo(canvas);
      }

      function negative() {
        let ImagemNegative = new SimpleImage(imagem);
        for (var p of ImagemNegative.values()) {
          p.setRed(255 - p.getRed());
          p.setGreen(255 - p.getGreen());
          p.setBlue(255 - p.getBlue());
        }

        var canvas = document.getElementById("ResultadoU");
        ImagemNegative.drawTo(canvas);
      }

      function red() {
        let imagemred = new SimpleImage(imagem);

        for (var p of imagemred.values()) {
          var avg = (p.getRed() + p.getGreen() + p.getBlue()) / 3;
          if ((p.getRed() > 40) & (p.getGreen() < 80) & (p.getBlue() < 80)) {
            p.setRed(p.getRed());
            p.setGreen(p.getGreen());
            p.setBlue(p.getBlue());
          } else {
            p.setRed(avg);
            p.setGreen(avg);
            p.setBlue(avg);
          }
        }

        var canvas = document.getElementById("ResultadoU");
        imagemred.drawTo(canvas);
      }

      function green() {
        let ImagemGreen = new SimpleImage(imagem);

        for (var p of ImagemGreen.values()) {
          var avg = (p.getRed() + p.getGreen() + p.getBlue()) / 3;
          if ((p.getGreen() > 40) & (p.getRed() < 80) & (p.getBlue() < 80)) {
            p.setRed(p.getRed());
            p.setGreen(p.getGreen());
            p.setBlue(p.getBlue());
          } else {
            p.setRed(avg);
            p.setGreen(avg);
            p.setBlue(avg);
          }
        }

        var canvas = document.getElementById("ResultadoU");
        ImagemGreen.drawTo(canvas);
      }

      function Blue() {
        let imagemBlue = new SimpleImage(imagem);
        //Mantem p Blue
        for (var p of imagemBlue.values()) {
          var avg = (p.getRed() + p.getGreen() + p.getBlue()) / 3;
          if ((p.getBlue() > 40) & (p.getRed() < 80) & (p.getGreen() < 80)) {
            p.setRed(p.getRed());
            p.setGreen(p.getGreen());
            p.setBlue(p.getBlue());
          } else {
            p.setRed(avg);
            p.setGreen(avg);
            p.setBlue(avg);
          }
        }

        var canvas = document.getElementById("ResultadoU");
        imagemBlue.drawTo(canvas);
      }

      /* DOWNLOAD DA IMAGEM CONVERTIDA */
      function DownloadImagem() {
        var download = document.getElementById("download");
        var image = document
          .getElementById("ResultadoU")
          .toDataURL("image/png")
          .replace("image/png", "image/octet-stream");
        download.setAttribute("href", image);
      }
    </script>
  </head>

  <body>
    <div>
      <h5 class="text-center mt-0 pt-0">Sabrina Topel - P8</h5>
    </div>
    <hr />

    <div class="container">
      <div class="row">
        <div class="col-sm">
          <input
            class="m-2 mb-2 text-success"
            type="file"
            id="UpButton"
            onchange="UploadImagem()"
            accept="image/*"
            multiple="false"
          /><br /><br />
          <button
            type="button"
            class="btn btn-primary col-6"
            onclick="negative()"
          >
            Negativo</button
          ><br /><br />
          <button type="button" class="btn btn-primary col-6" onclick="red()">
            Somente Vermelho</button
          ><br /><br />
          <button type="button" class="btn btn-primary col-6" onclick="green()">
            Somente Verde</button
          ><br /><br />
          <button type="button" class="btn btn-primary col-6" onclick="grey()">
            Escala de Cinza
          </button>
          <br /><br />
          <button type="button" class="btn btn-primary col-6" onclick="Blue()">
            Somente Azul</button
          ><br /><br />
          <br /><br />
          <a id="download" download="imagem_c_filtro.png">
            <button
              class="btn btn-success ml-2 mt-1 btn-sm col-6"
              type="button"
              onClick="DownloadImagem()"
            >
              Baixar a Imagem
            </button>
          </a>
        </div>
        <div class="col-sm">
          <h4 lass="mb-3">Imagem original</h4>
          <canvas class="ImagemMostrar" id="ImagemOri"> </canvas>
        </div>
        <div class="col-sm">
          <h4 class="mb-3">Resultado</h4>
          <canvas class="ImagemMostrar" id="ResultadoU"> </canvas>
        </div>
      </div>
    </div>
  </body>
</html>
